<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Funded Folk Chatbot</title>
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <header>
            <h1>🤖 Funded Folk Support Chatbot</h1>
            <p>Ask me anything about funded trading accounts!</p>
        </header>

        <div class="chat-container">
            <div class="chat-messages" id="chatMessages">
                <div class="message bot-message">
                    <div class="message-content">
                        Hello! I'm your Funded Folk support assistant. How can I help you today?
                    </div>
                    <div class="message-meta">
                        <span class="timestamp">Just now</span>
                    </div>
                </div>
            </div>

            <div class="chat-input-container">
                <div class="input-wrapper">
                    <input 
                        type="text" 
                        id="messageInput" 
                        placeholder="Type your message here..."
                        maxlength="500"
                    >
                    <button id="sendButton" class="send-button">
                        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2">
                            <path d="M22 2L11 13M22 2l-7 20-4-9-9-4 20-7z"/>
                        </svg>
                    </button>
                </div>
                <div class="input-footer">
                    <span id="charCount">0/500</span>
                    <span id="status" class="status">Ready</span>
                </div>
            </div>
        </div>

        <div class="info-panel">
            <h3>💡 Try asking:</h3>
            <div class="suggestions">
                <button class="suggestion-btn" data-query="How can I get funded account?">How can I get funded account?</button>
                <button class="suggestion-btn" data-query="What platforms do you support?">What platforms do you support?</button>
                <button class="suggestion-btn" data-query="How much does it cost?">How much does it cost?</button>
                <button class="suggestion-btn" data-query="What is the withdrawal process?">What is the withdrawal process?</button>
                <button class="suggestion-btn" data-query="I completed the challenge, but my account hasn't been activated yet. When will I receive access?">Account activation after challenge completion</button>
                <button class="suggestion-btn" data-query="Can you please update my dashboard? It's not reflecting my trades correctly.">Dashboard not updating trades</button>
                <button class="suggestion-btn" data-query="I can't log into my MT5 account. It shows an authorization error. What should I do?">MT5 login authorization error</button>
                <button class="suggestion-btn" data-query="Here are my login details. Can you help with my $50K account issue?">Help with $50K account issue</button>
                <button class="suggestion-btn" data-query="When will you provide Visa card as a payment method?">Visa card payment method</button>
                <button class="suggestion-btn" data-query="Why is my KYC not verified yet? It's been more than 24 hours.">KYC verification delay</button>
                <button class="suggestion-btn" data-query="I made the 10% profit. When will I get my real (funded) account?">When do I get funded account after 10% profit?</button>
                <button class="suggestion-btn" data-query="Why is my equity showing incorrectly in the dashboard after trades?">Equity showing incorrectly in dashboard</button>
                <button class="suggestion-btn" data-query="Is there a rule that restricts 35% of total profit from a single trade?">35% profit restriction rule</button>
                <button class="suggestion-btn" data-query="Do you accept documents from all countries for KYC, including Somalia or rural areas without utility bills?">KYC documents from all countries</button>
            </div>
        </div>
    </div>

    <script src="config.js?v=2"></script>
    <script>
        // RAG System - Embedded directly to avoid MIME type issues
        const KNOWLEDGE_BASE = [
            {
                id: 1,
                question: "How can I get funded account?",
                answer: "To get a funded account with Funded Folk, you need to complete a challenge program. Choose your account size ($5K-$200K), pass the challenge by meeting profit targets while following risk management rules, and then receive your funded account with up to 90% profit sharing.",
                combined_text: "Question: How can I get funded account?\nAnswer: To get a funded account with Funded Folk, you need to complete a challenge program. Choose your account size ($5K-$200K), pass the challenge by meeting profit targets while following risk management rules, and then receive your funded account with up to 90% profit sharing."
            },
            {
                id: 2,
                question: "What platforms do you support?",
                answer: "Funded Folk supports both MT4 and MT5 platforms. You can trade on either platform based on your preference. Both platforms are fully supported with all the same features and benefits.",
                combined_text: "Question: What platforms do you support?\nAnswer: Funded Folk supports both MT4 and MT5 platforms. You can trade on either platform based on your preference. Both platforms are fully supported with all the same features and benefits."
            },
            {
                id: 3,
                question: "How much does it cost?",
                answer: "Funded Folk offers various account sizes: $5K, $10K, $25K, $50K, $100K, and $200K. The cost varies by account size. You only pay for the challenge program, and once you pass, you get the funded account with no additional fees.",
                combined_text: "Question: How much does it cost?\nAnswer: Funded Folk offers various account sizes: $5K, $10K, $25K, $50K, $100K, and $200K. The cost varies by account size. You only pay for the challenge program, and once you pass, you get the funded account with no additional fees."
            },
            {
                id: 4,
                question: "What is the withdrawal process?",
                answer: "After you reach your profit target in the funded account, you can withdraw your profits. The withdrawal process is straightforward - you'll need to complete KYC verification first, then you can request withdrawals through the dashboard.",
                combined_text: "Question: What is the withdrawal process?\nAnswer: After you reach your profit target in the funded account, you can withdraw your profits. The withdrawal process is straightforward - you'll need to complete KYC verification first, then you can request withdrawals through the dashboard."
            },
            {
                id: 5,
                question: "Account activation after challenge completion",
                answer: "Once you complete the challenge successfully, your funded account will be activated within 24-48 hours. You'll receive login credentials for your MT4/MT5 account and can start trading with real money.",
                combined_text: "Question: Account activation after challenge completion\nAnswer: Once you complete the challenge successfully, your funded account will be activated within 24-48 hours. You'll receive login credentials for your MT4/MT5 account and can start trading with real money."
            },
            {
                id: 6,
                question: "Dashboard not updating trades",
                answer: "If your dashboard is not updating trades, please check your MT4/MT5 connection. Sometimes there can be a delay in trade synchronization. If the issue persists, contact support with your account details.",
                combined_text: "Question: Dashboard not updating trades\nAnswer: If your dashboard is not updating trades, please check your MT4/MT5 connection. Sometimes there can be a delay in trade synchronization. If the issue persists, contact support with your account details."
            },
            {
                id: 7,
                question: "MT5 login authorization error",
                answer: "If you're getting MT5 authorization errors, please verify your login credentials. Make sure you're using the correct server settings provided by Funded Folk. If the issue continues, contact support for assistance.",
                combined_text: "Question: MT5 login authorization error\nAnswer: If you're getting MT5 authorization errors, please verify your login credentials. Make sure you're using the correct server settings provided by Funded Folk. If the issue continues, contact support for assistance."
            },
            {
                id: 8,
                question: "Help with $50K account issue",
                answer: "For issues with your $50K account, please provide your account details and specific problem description. Our support team will help you resolve any technical or trading-related issues.",
                combined_text: "Question: Help with $50K account issue\nAnswer: For issues with your $50K account, please provide your account details and specific problem description. Our support team will help you resolve any technical or trading-related issues."
            },
            {
                id: 9,
                question: "Visa card payment method",
                answer: "Funded Folk accepts various payment methods including Visa cards. You can use your Visa card to pay for the challenge program. All payments are secure and processed through our trusted payment partners.",
                combined_text: "Question: Visa card payment method\nAnswer: Funded Folk accepts various payment methods including Visa cards. You can use your Visa card to pay for the challenge program. All payments are secure and processed through our trusted payment partners."
            },
            {
                id: 10,
                question: "KYC verification delay",
                answer: "KYC verification typically takes 24-48 hours. If it's been longer, please check that all documents are clear and complete. Contact support if you need assistance with the verification process.",
                combined_text: "Question: KYC verification delay\nAnswer: KYC verification typically takes 24-48 hours. If it's been longer, please check that all documents are clear and complete. Contact support if you need assistance with the verification process."
            }
        ];

        class HybridRAGSystem {
            constructor() {
                this.documents = KNOWLEDGE_BASE;
                this.modelUsageTimes = {};
            }

            searchSimilarDocuments(query, topK = 5) {
                const queryLower = query.toLowerCase();
                const queryWords = queryLower.split(' ').filter(word => word.length > 2);
                
                const scoredDocs = this.documents.map(doc => {
                    const questionLower = doc.question.toLowerCase();
                    const answerLower = doc.answer.toLowerCase();
                    const combinedLower = doc.combined_text.toLowerCase();
                    
                    let score = 0;
                    
                    if (questionLower.includes(queryLower)) score += 10;
                    if (answerLower.includes(queryLower)) score += 8;
                    if (combinedLower.includes(queryLower)) score += 6;
                    
                    queryWords.forEach(word => {
                        if (questionLower.includes(word)) score += 3;
                        if (answerLower.includes(word)) score += 2;
                        if (combinedLower.includes(word)) score += 1;
                    });
                    
                    const specialKeywords = ['funded', 'account', 'challenge', 'profit', 'withdrawal', 'kyc', 'mt4', 'mt5', 'dashboard'];
                    specialKeywords.forEach(keyword => {
                        if (queryLower.includes(keyword) && combinedLower.includes(keyword)) {
                            score += 2;
                        }
                    });
                    
                    return { ...doc, score };
                });
                
                return scoredDocs
                    .filter(doc => doc.score > 0)
                    .sort((a, b) => b.score - a.score)
                    .slice(0, topK);
            }

            async generateResponse(query) {
                const startTime = Date.now();
                const relevantDocs = this.searchSimilarDocuments(query);
                
                let response = '';
                let modelUsed = 'rag-system';
                let complexity = 'simple';
                
                if (relevantDocs.length > 0) {
                    const bestMatch = relevantDocs[0];
                    
                    if (bestMatch.score >= 8) {
                        response = bestMatch.answer;
                        modelUsed = 'rag-system (exact match)';
                    } else {
                        response = this.generateEnhancedResponse(query, relevantDocs);
                        modelUsed = 'rag-system (enhanced)';
                    }
                    
                    complexity = this.classifyQueryComplexity(query);
                } else {
                    response = this.generateFallbackResponse(query);
                    modelUsed = 'rag-system (fallback)';
                }
                
                const processingTime = Date.now() - startTime;
                
                return {
                    response: response,
                    model_used: modelUsed,
                    complexity: complexity,
                    relevant_docs_count: relevantDocs.length,
                    search_score: relevantDocs.length > 0 ? relevantDocs[0].score : 0,
                    processing_time_ms: processingTime
                };
            }

            generateEnhancedResponse(query, relevantDocs) {
                const baseAnswer = relevantDocs[0].answer;
                let enhancedResponse = baseAnswer;
                
                if (relevantDocs.length > 1) {
                    const additionalInfo = relevantDocs.slice(1).map(doc => doc.answer).join(' ');
                    enhancedResponse += `\n\nAdditionally: ${additionalInfo}`;
                }
                
                return enhancedResponse;
            }

            generateFallbackResponse(query) {
                const fallbackResponses = [
                    "I don't have specific information about that topic, but I can help you with questions about Funded Folk's funded trading accounts, challenge programs, platform support, pricing, and account management. Could you try asking about one of these topics?",
                    "That's a great question! While I don't have specific details about that, I can help you with information about getting funded accounts, platform support, pricing, withdrawal processes, and technical issues. What would you like to know about?",
                    "I'm not sure about that specific topic, but I'm here to help with Funded Folk related questions. You can ask me about account sizes, challenge programs, MT4/MT5 support, profit sharing, or any technical issues you might be experiencing."
                ];
                
                return fallbackResponses[Math.floor(Math.random() * fallbackResponses.length)];
            }

            classifyQueryComplexity(query) {
                const complexKeywords = [
                    'dashboard', 'equity', 'synchronization', 'authorization', 'verification',
                    'withdrawal', 'profit', 'restriction', 'violation', 'technical', 'error',
                    'login', 'connection', 'update', 'refresh'
                ];
                
                const queryLower = query.toLowerCase();
                const hasComplexKeywords = complexKeywords.some(keyword => 
                    queryLower.includes(keyword)
                );
                
                return hasComplexKeywords ? 'complex' : 'simple';
            }
        }

        // Initialize RAG system
        const ragSystem = new HybridRAGSystem();
        console.log('✅ RAG System initialized with', ragSystem.documents.length, 'documents');

        // Expose to window
        window.FundedFolkRAG = {
            system: ragSystem,
            generateResponse: async (query) => {
                console.log('🔍 RAG System processing query:', query);
                return await ragSystem.generateResponse(query);
            },
            searchDocuments: (query, topK) => {
                return ragSystem.searchSimilarDocuments(query, topK);
            }
        };
        console.log('✅ FundedFolkRAG exposed to window object');
    </script>
    <script src="chatbot.js?v=2"></script>
</body>
</html> 